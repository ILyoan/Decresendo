<html>

<head>
<script src="jquery/jquery.min.js"></script>
<script src="closure-library/closure/goog/base.js"></script>
<script src="decresendo/decresendo-deps.js"></script>
<script>
	goog.require("Decresendo");
</script>
</head>

<body>

<canvas id="piano"></canvas>

<script>

var loader = new Decresendo.Score.Loader(
	"./test/01a-Pitches-Pitches.xml",
	onScoreLoadSuccess,
	onScoreLoadError);
loader.load();

function onScoreLoadSuccess(data, textStatus, jqXHR) {
	var score = new Decresendo.Score.Score(data);
	console.log(score);
}

function onScoreLoadError(jqXHR, textStatus, errorThrown) {
	alert("score load failed: " + errorThrown);
}

var MIDI = Decresendo.MIDI;
var MIDIInput = null;
var MIDIOutput = null;

MIDI.Init(onMIDIInit, onMIDIFail);

function onMIDIInit() {
	MIDIInput = MIDI.getInput();
	MIDIOutput = MIDI.getOutput();
	MIDI.setMIDIEventHandler(MIDIInput, MIDIEventHandler);
}

function onMIDIFail(message) {
	alert(message);
}

function MIDIEventHandler(event) {
	MIDIOutput.send(event.data);
}

var pianoCanvas = document.getElementById("piano");
var pianoContext = pianoCanvas.getContext("2d");
var pianoRender = new Decresendo.Render.Piano(pianoContext, 5);
pianoCanvas.width = pianoRender.width;
pianoCanvas.height = pianoRender.height;
pianoRender.draw();

</script>

</body>
</html>

